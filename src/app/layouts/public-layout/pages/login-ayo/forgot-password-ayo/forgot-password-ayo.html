<h3 class="card-title">Recuperar Cuenta</h3>
<p class="card-subtitle">Información del Acudiente</p>

@if (currentStep === 1) {
    <form [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
            <label for="tipoDocumento">Tipo de Documento</label>
            <select id="tipoDocumento" formControlName="tipoDocumento" class="custom-input">
                <option value="" disabled selected>Selecciona una opción</option>
                @for (type of DOCUMENT_TYPE; track type.id) {
                    <option [value]="type.id">{{ type.name }}</option>
                }
            </select>
            @if (forgotPasswordForm.get('tipoDocumento')?.invalid && forgotPasswordForm.get('tipoDocumento')?.touched) {
                <div class="error-text">Tipo de documento requerido</div>
            }
        </div>

        <div class="form-group">
            <label for="numeroDocumento">Número de Documento</label>
            <input type="text" id="numeroDocumento" formControlName="numeroDocumento" class="custom-input" placeholder="Ej: 1000123456">
            @if (forgotPasswordForm.get('numeroDocumento')?.invalid && forgotPasswordForm.get('numeroDocumento')?.touched) {
                <div class="error-text">Número de documento requerido</div>
            }
        </div>

        <button type="submit" [disabled]="isLoading" class="btn-primary">
            @if (!isLoading) {
                <span>Consultar</span>
            }
            @if (isLoading) {
                <div class="spinner"></div>
            }
        </button>
    </form>
}

@if (currentStep === 2) {
    <div class="mt-5">
        <h4 class="font-bold mb-3">Seleccione el estudiante:</h4>
        <div class="flex flex-col gap-3">
            @for (student of students; track $index) {
                <div class="flex items-center gap-2 p-3 border rounded hover:bg-gray-50 cursor-pointer" (click)="onSelectStudent(student)">
                    <input type="radio" name="student" [id]="'student-' + $index" [checked]="selectedStudent?.id === student.id" (change)="onSelectStudent(student)">
                    <label [for]="'student-' + $index" class="cursor-pointer w-full">
                        <span class="font-bold">{{ student.nombre }} {{ student.apellido }}</span>
                        <span class="text-sm text-gray-500 block">{{ student.tipo_documento }} - {{ student.numero_documento }}</span>
                    </label>
                </div>
            }
        </div>
    </div>

    @if (selectedStudent) {
        <div class="mt-5">
            <form [formGroup]="resetPasswordForm">
                <div class="form-group">
                    <label for="registrationCode">Código de Registro</label>
                    <input type="text" id="registrationCode" formControlName="registrationCode" class="custom-input" placeholder="Ingrese el código de registro">
                </div>
                
                <button type="button" (click)="onValidateStudent()" class="btn-primary mt-3">
                    Validar
                </button>
            </form>
        </div>
    }
}

@if (currentStep === 3) {
    <div class="mt-5 pt-5 border-t">
        <h4 class="font-bold mb-3">Reestablecer Contraseña</h4>
        <form [formGroup]="resetPasswordForm" (ngSubmit)="onResetPassword()">
            <div class="form-group">
                <label for="email">Correo Electrónico</label>
                <input type="email" id="email" formControlName="email" class="custom-input" placeholder="correo@ejemplo.com">
                @if (resetPasswordForm.get('email')?.invalid && resetPasswordForm.get('email')?.touched) {
                    <div class="error-text">Correo electrónico inválido</div>
                }
            </div>

            <div class="form-group">
                <label for="password">Nueva Contraseña</label>
                <input type="password" id="password" formControlName="password" class="custom-input" placeholder="Mínimo 6 caracteres">
                @if (resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched) {
                    <div class="error-text">La contraseña debe tener al menos 6 caracteres</div>
                }
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirmar Contraseña</label>
                <input type="password" id="confirmPassword" formControlName="confirmPassword" class="custom-input" placeholder="Repita la contraseña">
                @if (resetPasswordForm.hasError('mismatch') && resetPasswordForm.get('confirmPassword')?.touched) {
                    <div class="error-text">Las contraseñas no coinciden</div>
                }
            </div>

            <button type="submit" [disabled]="isLoading || resetPasswordForm.invalid" class="btn-primary mt-3">
                @if (!isLoading) {
                    <span>Cambiar Contraseña</span>
                }
                @if (isLoading) {
                    <div class="spinner"></div>
                }
            </button>
        </form>
    </div>
}

<div class="my-5 toggle-container">
    <p>
        <a (click)="onBack()" href="javascript:void(0)" class="text-blue-700 underline cursor-pointer hover:text-blue-800">Volver al inicio</a>
    </p>
</div>
